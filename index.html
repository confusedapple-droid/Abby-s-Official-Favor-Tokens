<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>Favor Tokens</title>

<style>
:root{
  --bg1:#ffd1ea; --bg2:#ff69b4;
  --card1:#ffd700; --card2:#ff9acb;
}
*{box-sizing:border-box}
body{
  margin:0;
  height:100dvh;
  display:flex;
  justify-content:center;
  align-items:center;
  font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Arial;
  background:radial-gradient(circle at top,var(--bg1),var(--bg2));
}

/* CARD */
.card-container{
  width:min(92vw,380px);
  height:92dvh;
  max-height:640px;
  perspective:1200px;
}
.card{
  width:100%; height:100%;
  position:relative;
  transform-style:preserve-3d;
  transition:.6s ease;
}
.card.flipped{ transform:rotateY(180deg); }

.face{
  position:absolute;
  inset:0;
  border-radius:28px;
  backface-visibility:hidden;
  border:2px solid #fff;
  box-shadow:0 30px 60px rgba(0,0,0,.3);
  display:flex;
  flex-direction:column;
}

/* FRONT */
.front{
  background:linear-gradient(135deg,var(--card1),var(--card2));
}
.header{
  padding:20px;
  text-align:center;
  font-weight:900;
  letter-spacing:3px;
  color:#fff;
}
.grid{
  flex:1;
  display:grid;
  grid-template-columns:1fr 1fr;
  grid-template-rows:repeat(3,1fr);
  gap:14px;
  padding:16px;
}
.slot{
  background:rgba(255,255,255,.3);
  border:2px dashed #fff;
  border-radius:16px;
  position:relative;
}
canvas{width:100%;height:100%;touch-action:none}
.slot.used canvas{opacity:.3;pointer-events:none}
.stamp{
  position:absolute;
  top:50%;left:50%;
  transform:translate(-50%,-50%) rotate(-20deg) scale(2);
  background:#fff;
  color:#ff69b4;
  font-weight:900;
  padding:6px 12px;
  border:3px solid #ff69b4;
  opacity:0;
}
.slot.used .stamp{
  animation:stamp .3s ease forwards;
}
@keyframes stamp{
  to{opacity:1;transform:translate(-50%,-50%) rotate(-10deg) scale(1)}
}

/* FOOTER */
.footer{
  padding:16px;
  display:flex;
  gap:10px;
}
button{
  flex:1;
  padding:14px;
  border:none;
  border-radius:14px;
  font-weight:800;
}

/* BACK */
.back{
  background:linear-gradient(135deg,var(--card2),var(--card1));
  transform:rotateY(180deg);
  color:#fff;
  padding:24px;
  overflow-y:auto;
}
.rules{
  line-height:1.6;
}
input{
  margin-top:20px;
  padding:14px;
  border:none;
  border-radius:14px;
  width:100%;
  font-size:1rem;
}

/* FLOATING BACK BUTTON — KEY FIX */
.back-pill{
  position:absolute;
  top:16px;
  left:16px;
  z-index:999;
  background:rgba(255,255,255,.9);
  color:#ff69b4;
  padding:8px 14px;
  border-radius:999px;
  font-weight:800;
}
</style>
</head>

<body>

<div class="card-container">
  <div class="card" id="card">

    <!-- FRONT -->
    <div class="face front">
      <div class="header">FAVOR TOKENS</div>
      <div class="grid" id="grid"></div>
      <div class="footer">
        <button onclick="flip()">Rules & Reset</button>
      </div>
    </div>

    <!-- BACK -->
    <div class="face back">
      <div class="back-pill" onclick="unflip()">← Back</div>

      <h2>GENIE RULES</h2>
      <div class="rules">
        • No wishing for more wishes<br>
        • No bringing back the dead<br>
        • No forcing love<br>
        • Tokens are non-transferable
      </div>

      <input id="reset" placeholder="Reset Password">
    </div>

  </div>
</div>

<script>
const card=document.getElementById("card");
function flip(){card.classList.add("flipped")}
function unflip(){card.classList.remove("flipped")}

/* GRID */
const grid=document.getElementById("grid");
const state=Array(6).fill(0);

for(let i=0;i<6;i++){
  const s=document.createElement("div");
  s.className="slot";
  s.innerHTML='<canvas></canvas><div class="stamp">REDEEMED</div>';
  grid.appendChild(s);

  const c=s.querySelector("canvas");
  const ctx=c.getContext("2d");
  let draw=false;

  function resize(){
    const r=c.getBoundingClientRect();
    c.width=r.width*devicePixelRatio;
    c.height=r.height*devicePixelRatio;
    ctx.setTransform(devicePixelRatio,0,0,devicePixelRatio,0,0);
  }
  resize(); window.addEventListener("resize",resize);

  c.onpointerdown=e=>{
    if(state[i])return;
    draw=true;ctx.beginPath();
  };
  c.onpointermove=e=>{
    if(!draw)return;
    const r=c.getBoundingClientRect();
    ctx.lineWidth=3;
    ctx.strokeStyle="#ff69b4";
    ctx.lineTo(e.clientX-r.left,e.clientY-r.top);
    ctx.stroke();
  };
  c.onpointerup=()=>{
    if(!draw)return;
    draw=false;
    state[i]=1;
    s.classList.add("used");
    navigator.vibrate?.(40);
  };
}

/* RESET */
reset.onchange=()=>{
  if(reset.value==="apple"){
    state.fill(0);
    document.querySelectorAll(".slot").forEach(s=>s.classList.remove("used"));
    reset.value="";
    unflip();
  }
};
</script>

</body>
</html>
